
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>josephson_circuit &#8212; pyjjasim 2.2.7 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">pyjjasim</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pyjjasim.html">
  pyjjasim API
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
<h3><a href="../index.html">Table of Contents</a></h3>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pyjjasim.html">pyjjasim API</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <h1>Source code for josephson_circuit</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pyjjasim.embedded_graph</span> <span class="kn">import</span> <span class="n">EmbeddedGraph</span><span class="p">,</span> <span class="n">EmbeddedTriangularGraph</span><span class="p">,</span> <span class="n">EmbeddedHoneycombGraph</span><span class="p">,</span> <span class="n">EmbeddedSquareGraph</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span>
<span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span>
<span class="kn">import</span> <span class="nn">scipy.spatial</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Circuit&quot;</span><span class="p">,</span> <span class="s2">&quot;SquareArray&quot;</span><span class="p">,</span> <span class="s2">&quot;HoneycombArray&quot;</span><span class="p">,</span> <span class="s2">&quot;TriangularArray&quot;</span><span class="p">,</span> <span class="s2">&quot;SQUID&quot;</span><span class="p">]</span>

<span class="c1"># TODO:</span>
<span class="c1"># - work out if area and frustration definition</span>
<span class="c1"># - give error if criterion all-or-nothing inductance is not met.</span>
<span class="c1"># - give warning if timestep too small in low-inductance-case</span>
<span class="c1"># - give error for mixed-inductance problems</span>
<span class="c1"># - only show combined error?</span>
<span class="c1"># - handle time evolution proper errors if required quantities are not computed.</span>
<span class="c1"># - time evolution config_at_minus1 list of configs</span>
<span class="c1"># - put references in documentation</span>

<span class="c1"># nice to haves</span>
<span class="c1"># - lattices</span>
<span class="c1"># - periodic lattices</span>
<span class="c1"># - 3D</span>
<span class="c1"># - Multigrid</span>
<span class="c1"># - Nonlinear resistors</span>
<span class="c1"># - GPU</span>
<span class="c1">#   * single/double precision</span>
<span class="c1">#   * phase build-up rounding correction</span>



<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Josephson Circuit Module</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">NoCurrentConservationError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span>

<div class="viewcode-block" id="Circuit"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit">[docs]</a><span class="k">class</span> <span class="nc">Circuit</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construct a Josephson Circuit, also called a Josephson Junction Array (JJA).</span>

<span class="sd">    A JJA is an electric circuit that can include Josephson junctions, passive components,</span>
<span class="sd">    current sources and voltage sources. The network is required to be a planar embedding</span>
<span class="sd">    and single component, so junctions cannot intersect.</span>

<span class="sd">    Defined with a graph of nodes and edges where each edge contains a junction.</span>
<span class="sd">    A junction is the basic 2-terminal element which contains one of each component,</span>
<span class="sd">    see the included user manual for the precise definition. To omit a component;</span>
<span class="sd">    set it&#39;s value to zero.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    graph : :py:attr:`embedded_graph.EmbeddedGraph`</span>
<span class="sd">        EmbeddedGraph instance with Nn nodes, Nj edges and Nf faces.</span>
<span class="sd">    critical_current_factors=1.0 : (Nj,) array or scalar</span>
<span class="sd">        Critical current factors of junctions. Same value for all junctions if scalar.</span>
<span class="sd">    resistance_factors=1.0 : (Nj,) array or scalar</span>
<span class="sd">        Resistance factors of junctions. Same value for all junctions if scalar.</span>
<span class="sd">    capacitance_factors=0.0 : (Nj,) array or scalar</span>
<span class="sd">        Capacitance factors of junctions. Same value for all junctions if scalar.</span>
<span class="sd">    inductance_factors=0.0 : (Nj,) array or scalar</span>
<span class="sd">        Self-inductance factors of junctions. Same value for all junctions if scalar.</span>
<span class="sd">    or inductance_factors=0.0 : (Nj, Nj) matrix (dense or sparse)</span>
<span class="sd">        L_ij coupling between junction i and j. L_ii self inductance. Must be symmetric</span>
<span class="sd">        positive definite.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    * All physical quantities are normalized in pyjjasim, see the user manual for details.</span>
<span class="sd">      For example the critical current of each junction in Ampere is</span>
<span class="sd">      :math:`\mathtt{critical\_current\_factors} * I_0`, where :math:`I_0` is the</span>
<span class="sd">      normalizing scalar for all current values.</span>
<span class="sd">    * Sources are specified at problems, not explicitly as part of the circuit.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">graph</span><span class="p">:</span> <span class="n">EmbeddedGraph</span><span class="p">,</span> <span class="n">critical_current_factors</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">resistance_factors</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">capacitance_factors</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inductance_factors</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_assign_faces</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_assert_planar_embedding</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_assert_single_component</span><span class="p">()</span>
        <span class="n">n</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_l_cycles</span><span class="p">(</span><span class="n">to_list</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">permute_faces</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">faces_v_array</span><span class="o">.</span><span class="n">cum_counts</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_assert_planar_embedding</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_assert_single_component</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critical_current_factors</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_resistance_factors</span><span class="p">(</span><span class="n">resistance_factors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_critical_current_factors</span><span class="p">(</span><span class="n">critical_current_factors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_capacitance_factors</span><span class="p">(</span><span class="n">capacitance_factors</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_inductance_factors</span><span class="p">(</span><span class="n">inductance_factors</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">cut_space_matrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycle_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">face_cycle_matrix</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_reduced_square</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_square</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced_transposed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_transposed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycle_matrix_transposed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cycle_square</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Mnorm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Anorm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_inductance_v</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Circuit.get_junction_nodes"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_junction_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_junction_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get indices of nodes at endpoints of all junctions.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        For all junctions node1 &lt; node2, even if it was defined in reverse order.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        node1, node2 : (Nj,) arrays</span>
<span class="sd">            Endpoint node indices of all junctions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_edges</span><span class="p">()</span></div>

<div class="viewcode-block" id="Circuit.get_juncion_coordinates"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_juncion_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">get_juncion_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get coordinates of nodes at endpoints of all junctions.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        For all junctions node1 &lt; node2, even if it was defined in reverse order.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x1, y1, x2, y2 : (Nj,) arrays</span>
<span class="sd">            Coordinates of node1 and node2 respectively.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_coordinates</span><span class="p">()</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">n2</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span></div>

    <span class="c1"># noinspection PyArgumentList</span>
<div class="viewcode-block" id="Circuit.copy"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return copy of circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">EmbeddedGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">),</span>
                       <span class="n">critical_current_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_critical_current_factors</span><span class="p">(),</span>
                       <span class="n">resistance_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_resistance_factors</span><span class="p">(),</span>
                       <span class="n">capacitance_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_capacitance_factors</span><span class="p">(),</span>
                       <span class="n">inductance_factors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">get_inductance_factors</span><span class="p">())</span></div>

    <span class="c1"># noinspection PyArgumentList</span>
<div class="viewcode-block" id="Circuit.add_nodes_and_junctions"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.add_nodes_and_junctions">[docs]</a>    <span class="k">def</span> <span class="nf">add_nodes_and_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">,</span>
                                <span class="n">critical_current_factors</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">resistance_factors</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                                <span class="n">capacitance_factors</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">inductance_factors</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Add nodes to array and junctions to array.</span>

<span class="sd">            Attributes</span>
<span class="sd">            ----------</span>
<span class="sd">            x, y : (Nn_new,) arrays</span>
<span class="sd">                Coordinates of added nodes.</span>
<span class="sd">            node1, node2 : (Nj_new,) int arrays</span>
<span class="sd">                Nodes at endpoints of added junctions.</span>
<span class="sd">            critical_current_factors : scalar or (Nj_new,) array</span>
<span class="sd">                Critical current factors of added junctions. Same value for</span>
<span class="sd">                all new junctions if scalar.</span>
<span class="sd">            resistance_factors : scalar or (Nj_new,) array</span>
<span class="sd">                Resistance factors of added junctions. Same value for</span>
<span class="sd">                all new junctions if scalar.</span>
<span class="sd">            capacitance_factors : scalar or (Nj_new,) array</span>
<span class="sd">                Capacitance factors of added junctions. Same value for</span>
<span class="sd">                all new junctions if scalar.</span>
<span class="sd">            inductance_factors : scalar or (Nj_new,) array</span>
<span class="sd">                Self-inductance factors of added junctions. Same value for</span>
<span class="sd">                all new junctions if scalar.</span>
<span class="sd">            or inductance_factors : (Nj_new, Nj_new) array</span>
<span class="sd">                Mutual inductance factors between new junctions.</span>
<span class="sd">            or inductance_factors : (Nj_new, Nj) array</span>
<span class="sd">                Mutual inductance factors between new junctions and all junctions.</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            new_circuit : :py:attr:`Circuit`</span>
<span class="sd">                New Circuit object with nodes and junctions added.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="n">new_node1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">new_node2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">node2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">Nj</span><span class="p">,</span> <span class="n">Nj_new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">junction_count</span><span class="p">(),</span> <span class="nb">len</span><span class="p">(</span><span class="n">node1</span><span class="p">)</span>
        <span class="n">new_Ic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">critical_current_factors</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_junction_quantity</span><span class="p">(</span><span class="n">critical_current_factors</span><span class="p">,</span> <span class="n">Nj_new</span><span class="p">,</span> <span class="n">x_name</span><span class="o">=</span><span class="s2">&quot;Ic&quot;</span><span class="p">))</span>
        <span class="n">new_R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_junction_quantity</span><span class="p">(</span><span class="n">resistance_factors</span><span class="p">,</span> <span class="n">Nj_new</span><span class="p">,</span> <span class="n">x_name</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">))</span>
        <span class="n">new_C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_junction_quantity</span><span class="p">(</span><span class="n">capacitance_factors</span><span class="p">,</span> <span class="n">Nj_new</span><span class="p">,</span> <span class="n">x_name</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">))</span>
        <span class="n">new_L</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">inductance_factors</span><span class="p">,</span> <span class="s1">&#39;shape&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">inductance_factors</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">Nj_new</span><span class="p">,</span> <span class="n">Nj</span><span class="o">+</span><span class="n">Nj_new</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">inductance_factors</span><span class="p">):</span>
                    <span class="n">inductance_factors</span> <span class="o">=</span> <span class="n">inductance_factors</span><span class="o">.</span><span class="n">tocsc</span><span class="p">()</span>
                <span class="n">A_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span>
                <span class="n">C_block</span> <span class="o">=</span> <span class="n">inductance_factors</span><span class="p">[:,</span> <span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">junction_count</span><span class="p">()]</span>
                <span class="n">D_block</span> <span class="o">=</span> <span class="n">inductance_factors</span><span class="p">[:,</span> <span class="bp">self</span><span class="o">.</span><span class="n">junction_count</span><span class="p">():]</span>
                <span class="n">new_L</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">bmat</span><span class="p">([[</span><span class="n">A_block</span><span class="p">,</span> <span class="n">C_block</span><span class="o">.</span><span class="n">T</span><span class="p">],</span> <span class="p">[</span><span class="n">C_block</span><span class="p">,</span> <span class="n">D_block</span><span class="p">]])</span>
        <span class="k">if</span> <span class="n">new_L</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">D_block</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Circuit</span><span class="o">.</span><span class="n">_prepare_inducance_matrix</span><span class="p">(</span><span class="n">inductance_factors</span><span class="p">,</span> <span class="n">Nj_new</span><span class="p">)</span>
            <span class="n">new_L</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">block_diag</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span><span class="p">,</span> <span class="n">D_block</span><span class="p">])</span>
        <span class="n">new_circuit</span> <span class="o">=</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">EmbeddedGraph</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">,</span> <span class="n">new_node1</span><span class="p">,</span> <span class="n">new_node2</span><span class="p">),</span>
                       <span class="n">critical_current_factors</span><span class="o">=</span><span class="n">new_Ic</span><span class="p">,</span> <span class="n">resistance_factors</span><span class="o">=</span><span class="n">new_R</span><span class="p">,</span>
                       <span class="n">capacitance_factors</span><span class="o">=</span><span class="n">new_C</span><span class="p">,</span> <span class="n">inductance_factors</span><span class="o">=</span><span class="n">new_L</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">new_circuit</span></div>

    <span class="c1"># noinspection PyArgumentList</span>
<div class="viewcode-block" id="Circuit.remove_nodes"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.remove_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">remove_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodes_to_remove</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove nodes from circuit.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        nodes_to_remove : int array in range(Nn)</span>
<span class="sd">            Indices of nodes to remove from circuit.</span>
<span class="sd">        or nodes_to_remove : (Nn,) mask</span>
<span class="sd">            Mask selecting nodes to remove from circuit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_circuit : :py:attr:`Circuit`</span>
<span class="sd">            New Circuit object with removed nodes.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Junctions whose endpoints are removed are also removed.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes_to_remove</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes_to_remove</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_count</span><span class="p">():</span>
            <span class="n">nodes_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes_to_remove</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes_to_remove</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">node_remove_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_count</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
                <span class="n">node_remove_mask</span><span class="p">[</span><span class="n">nodes_to_remove</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid nodes_to_remove; must be None, mask, slice or index array&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">node_remove_mask</span> <span class="o">=</span> <span class="n">nodes_to_remove</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">node_remove_mask</span><span class="p">]</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">node_remove_mask</span><span class="p">]</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="n">junc_remove_mask</span><span class="p">,</span> <span class="n">new_node_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_junction_remove_mask</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">node_remove_mask</span><span class="p">)</span>
        <span class="n">new_node1</span> <span class="o">=</span> <span class="n">new_node_id</span><span class="p">[</span><span class="n">n1</span><span class="p">][</span><span class="o">~</span><span class="n">junc_remove_mask</span><span class="p">]</span>
        <span class="n">new_node2</span> <span class="o">=</span> <span class="n">new_node_id</span><span class="p">[</span><span class="n">n2</span><span class="p">][</span><span class="o">~</span><span class="n">junc_remove_mask</span><span class="p">]</span>
        <span class="n">new_Ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical_current_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junc_remove_mask</span><span class="p">]</span>
        <span class="n">new_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junc_remove_mask</span><span class="p">]</span>
        <span class="n">new_C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junc_remove_mask</span><span class="p">]</span>
        <span class="n">new_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junc_remove_mask</span><span class="p">,</span> <span class="p">:][:,</span> <span class="o">~</span><span class="n">junc_remove_mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">EmbeddedGraph</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span><span class="p">,</span> <span class="n">new_node1</span><span class="p">,</span> <span class="n">new_node2</span><span class="p">),</span>
                       <span class="n">critical_current_factors</span><span class="o">=</span><span class="n">new_Ic</span><span class="p">,</span> <span class="n">resistance_factors</span><span class="o">=</span><span class="n">new_R</span><span class="p">,</span>
                       <span class="n">capacitance_factors</span><span class="o">=</span><span class="n">new_C</span><span class="p">,</span> <span class="n">inductance_factors</span><span class="o">=</span><span class="n">new_L</span><span class="p">)</span></div>

    <span class="c1"># noinspection PyArgumentList</span>
<div class="viewcode-block" id="Circuit.remove_junctions"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.remove_junctions">[docs]</a>    <span class="k">def</span> <span class="nf">remove_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">junctions_to_remove</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove junctions from circuit.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        junctions_to_remove : int array in range(Nj)</span>
<span class="sd">            Indices of junctions to remove from circuit.</span>
<span class="sd">        or junctions_to_remove : (Nj,) mask</span>
<span class="sd">            Mask selecting junctions to remove from circuit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_circuit : :py:attr:`Circuit`</span>
<span class="sd">            New Circuit object with removed junctions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">junctions_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">junctions_to_remove</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">junctions_to_remove</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">junction_count</span><span class="p">():</span>
            <span class="n">junctions_to_remove</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">junctions_to_remove</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">junctions_to_remove</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="p">(</span><span class="nb">bool</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">junction_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">junction_count</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
                <span class="n">junction_mask</span><span class="p">[</span><span class="n">junctions_to_remove</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid junctions_to_remove; must be None, mask, slice or index array&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">junction_mask</span> <span class="o">=</span> <span class="n">junctions_to_remove</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="n">new_node1</span><span class="p">,</span> <span class="n">new_node2</span> <span class="o">=</span> <span class="n">n1</span><span class="p">[</span><span class="o">~</span><span class="n">junction_mask</span><span class="p">],</span> <span class="n">n2</span><span class="p">[</span><span class="o">~</span><span class="n">junction_mask</span><span class="p">]</span>
        <span class="n">new_Ic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical_current_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junction_mask</span><span class="p">]</span>
        <span class="n">new_R</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junction_mask</span><span class="p">]</span>
        <span class="n">new_C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junction_mask</span><span class="p">]</span>
        <span class="n">new_L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span><span class="p">[</span><span class="o">~</span><span class="n">junction_mask</span><span class="p">,</span> <span class="p">:][:,</span> <span class="o">~</span><span class="n">junction_mask</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Circuit</span><span class="p">(</span><span class="n">EmbeddedGraph</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">new_node1</span><span class="p">,</span> <span class="n">new_node2</span><span class="p">),</span>
                       <span class="n">critical_current_factors</span><span class="o">=</span><span class="n">new_Ic</span><span class="p">,</span> <span class="n">resistance_factors</span><span class="o">=</span><span class="n">new_R</span><span class="p">,</span>
                       <span class="n">capacitance_factors</span><span class="o">=</span><span class="n">new_C</span><span class="p">,</span> <span class="n">inductance_factors</span><span class="o">=</span><span class="n">new_L</span><span class="p">)</span></div>

<div class="viewcode-block" id="Circuit.get_node_coordinates"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_node_coordinates">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns coordinates of nodes in circuit.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        x, y : (Nn,) arrays</span>
<span class="sd">            Coordinates of nodes in circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">y</span></div>

<div class="viewcode-block" id="Circuit.node_count"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.node_count">[docs]</a>    <span class="k">def</span> <span class="nf">node_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns number of nodes in the circuit (abbreviated Nn).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nn</span><span class="p">()</span></div>

<div class="viewcode-block" id="Circuit.get_critical_current_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_critical_current_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_critical_current_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns critical current factors of each junction in the circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical_current_factors</span></div>

<div class="viewcode-block" id="Circuit.set_critical_current_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.set_critical_current_factors">[docs]</a>    <span class="k">def</span> <span class="nf">set_critical_current_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Ic</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify critical current factors of all junctions in the circuit.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        Ic : (Nj,) array or scalar</span>
<span class="sd">            New critical current factors. Same for all junctions if scalar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">critical_current_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_junction_quantity</span><span class="p">(</span><span class="n">Ic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">(),</span> <span class="n">x_name</span><span class="o">=</span><span class="s2">&quot;Ic&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Circuit.get_resistance_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_resistance_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_resistance_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns resistance factors assigned to each junction in the circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span></div>

<div class="viewcode-block" id="Circuit.set_resistance_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.set_resistance_factors">[docs]</a>    <span class="k">def</span> <span class="nf">set_resistance_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify resistance factors of all junctions in the circuit.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        R : (Nj,) array or scalar</span>
<span class="sd">            New resistance factors. Same for all junctions if scalar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_junction_quantity</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">(),</span> <span class="n">x_name</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All junctions must have a positive resistor&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Circuit.get_capacitance_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_capacitance_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_capacitance_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns capacitance factors assigned to each junction in the circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span></div>

<div class="viewcode-block" id="Circuit.set_capacitance_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.set_capacitance_factors">[docs]</a>    <span class="k">def</span> <span class="nf">set_capacitance_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify capacitance factors of all junctions in the circuit.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        C : (Nj,) array or scalar</span>
<span class="sd">            New capacitance factors. Same for all junctions if scalar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_junction_quantity</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">(),</span> <span class="n">x_name</span><span class="o">=</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Capacitance cannot be negative.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Circuit.junction_count"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.junction_count">[docs]</a>    <span class="k">def</span> <span class="nf">junction_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns number of junctions in the circuit (abbreviated Nj).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">()</span></div>

<div class="viewcode-block" id="Circuit.face_count"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.face_count">[docs]</a>    <span class="k">def</span> <span class="nf">face_count</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns number of faces in the circuit (abbreviated Nf).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nf</span><span class="p">()</span></div>

<div class="viewcode-block" id="Circuit.get_faces"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_faces">[docs]</a>    <span class="k">def</span> <span class="nf">get_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of all faces.</span>

<span class="sd">        A face is defined as an array containing indices of nodes encountered when</span>
<span class="sd">        traversing the boundary of a face counter-clockwise.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        faces : List</span>
<span class="sd">            List of faces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Returns a list of faces.</span>
        <span class="c1"># if to_list==True returns in format:  [[n11, n12, n13], [n21], [n31, n32]]</span>
        <span class="c1"># if to_list==False returns in format: [n11, n12, n13, n21, n31, n32], [3, 1, 2]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_face_cycles</span><span class="p">(</span><span class="n">to_list</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Circuit.get_face_areas"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_face_areas">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns area of all faces in the circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Returns unsigned area of each face in array.</span>
        <span class="c1"># out: areas            (face_count,) positive float array</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_face_areas</span><span class="p">()</span></div>

<div class="viewcode-block" id="Circuit.get_face_centroids"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_face_centroids">[docs]</a>    <span class="k">def</span> <span class="nf">get_face_centroids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns coordinates of centroids of all faces in the circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Returns centroid face_x, face_y of each face in array.</span>
        <span class="c1"># out: face_x, face_y   (face_count,) float arrRuehliay</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">get_face_centroids</span><span class="p">()</span></div>

<div class="viewcode-block" id="Circuit.locate_faces"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.locate_faces">[docs]</a>    <span class="k">def</span> <span class="nf">locate_faces</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Get faces whose centroids are closest to queried coordinate.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        x, y : arrays:</span>
<span class="sd">            Coordinates at which one wants to locate faces.</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        face_ids : int array with same size as x in range(Nf)</span>
<span class="sd">            Indices of located faces.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">locator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">faces</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">locator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">locate_faces</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">faces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locator</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">faces</span></div>

<div class="viewcode-block" id="Circuit.approximate_inductance"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.approximate_inductance">[docs]</a>    <span class="k">def</span> <span class="nf">approximate_inductance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">junc_L</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">junc_M</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_dist</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Approximate inductance in circuit.</span>

<span class="sd">        Computes a matrix L as an approximation for the inductance factors and</span>
<span class="sd">        does self.set_inductance_factors(L).</span>

<span class="sd">        L is computed using a crude approximation of Neumann&#39;s formula for two wire segments.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        factor : scalar float</span>
<span class="sd">            mu0 * a0 in units of L0.</span>
<span class="sd">        junc_L : scalar float</span>
<span class="sd">            Self-inductance prefactor.</span>
<span class="sd">        junc_M : scalar float</span>
<span class="sd">            Mutual-inductance prefactor.</span>
<span class="sd">        max_dist : scalar float</span>
<span class="sd">            Cut-off distance between junctions included in L.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The self and mutual inductance are respectively (in units of :math:`\mu_0 a_0`):</span>

<span class="sd">        .. math:: L_i = \mathtt{junc\_L} * l_i</span>

<span class="sd">        .. math:: M_{ij} = \mathtt{junc\_M} * l_i * l_j * cos( \gamma_{ij}) / d_{ij}</span>

<span class="sd">        Where :math:`l_i` is junction length in units of :math:`a_0`,</span>
<span class="sd">        :math:`\gamma_{ij}` is angle between junctions and</span>
<span class="sd">        :math:`d_{ij}` is distance between centres of junctions in units of :math:`a_0`</span>
<span class="sd">        and afterwards they are multiplied by the conversion factor :math:`\mathtt{factor}=\mu_0 a_0 / L_0`</span>
<span class="sd">        to obain the required units of :math:`L_0`.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">(),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_junction_lengths</span><span class="p">()</span> <span class="o">*</span> <span class="n">junc_L</span>
        <span class="k">if</span> <span class="n">junc_M</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">max_dist</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">spatial</span><span class="o">.</span><span class="n">KDTree</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_junction_centers</span><span class="p">(),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">pairs</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_pairs</span><span class="p">(</span><span class="n">max_dist</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;ndarray&#39;</span><span class="p">)</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pairs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">pairs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">pairs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">pairs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">inner</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_junction_inner</span><span class="p">(</span><span class="o">*</span><span class="n">pairs</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_junction_distance</span><span class="p">(</span><span class="o">*</span><span class="n">pairs</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
            <span class="n">mutual</span> <span class="o">=</span> <span class="n">junc_M</span> <span class="o">*</span> <span class="n">inner</span> <span class="o">/</span> <span class="n">distance</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mutual</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mutual</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_inductance_factors</span><span class="p">(</span><span class="n">factor</span> <span class="o">*</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">coo_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">()))</span><span class="o">.</span><span class="n">tocsr</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Circuit.get_inductance_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_inductance_factors">[docs]</a>    <span class="k">def</span> <span class="nf">get_inductance_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the inductance factors between each pair of junctions.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        inductance_factors : (Nj, Nj) array</span>
<span class="sd">            Diagonal entries are self-inductance factors, off-diagonal entries are mutual.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># return matrix whose entry (r, c) is the magnetic coupling between wire r and wire c.</span>
        <span class="c1"># out: (junction_count, junction_count) sparse symmetric float matrix</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span></div>

<div class="viewcode-block" id="Circuit.set_inductance_factors"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.set_inductance_factors">[docs]</a>    <span class="k">def</span> <span class="nf">set_inductance_factors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inductance_factors</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modify the inductances factors of all junctions in the circuit.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span><span class="p">,</span> <span class="n">is_positive_definite</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_inductance_v</span> <span class="o">=</span> \
            <span class="n">Circuit</span><span class="o">.</span><span class="n">_prepare_inducance_matrix</span><span class="p">(</span><span class="n">inductance_factors</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nj</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_positive_definite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Inductance matrix not positive definite&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="Circuit.get_cut_matrix"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_cut_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_cut_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns cut matrix.</span>

<span class="sd">        The cut matrix is a sparse matrix (shape (Nn, Nj), abbreviated M), which represents</span>
<span class="sd">        Kirchhoffs current law M @ I = 0.</span>

<span class="sd">        It is +1 if node is node_2 of junction and -1 otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix</span></div>

<div class="viewcode-block" id="Circuit.get_cycle_matrix"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.get_cycle_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">get_cycle_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns cycle matrix.</span>

<span class="sd">        The cycle matrix is a sparse matrix (shape (Nf, Nj) abbreviated A), which represents</span>
<span class="sd">        Kirchhoffs voltage law A @ V = 0.</span>

<span class="sd">        It is +1 if traversing a face counter-clockwise passes through a junction in its direction, and -1</span>
<span class="sd">        otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cycle_matrix</span></div>

<div class="viewcode-block" id="Circuit.plot"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.Circuit.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_node_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_junction_ids</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">show_face_ids</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">face_shrink_factor</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
             <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Visualize array.</span>

<span class="sd">        Can show nodes, junctions and faces; and their respective indices.</span>

<span class="sd">        For documentation see :py:attr:`embedded_graph.EmbeddedGraph.plot`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">show_cycles</span><span class="o">=</span><span class="n">show_faces</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">cycles</span><span class="o">=</span><span class="s2">&quot;face_cycles&quot;</span><span class="p">,</span>
                             <span class="n">show_node_ids</span><span class="o">=</span><span class="n">show_node_ids</span><span class="p">,</span> <span class="n">show_edge_ids</span><span class="o">=</span><span class="n">show_junction_ids</span><span class="p">,</span>
                             <span class="n">show_face_ids</span><span class="o">=</span><span class="n">show_face_ids</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">face_shrink_factor</span><span class="o">=</span><span class="n">face_shrink_factor</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cr</span></div>

    <span class="c1"># abbreviations and aliases</span>
    <span class="k">def</span> <span class="nf">_Nn</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   <span class="c1"># alias for node_count</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">node_count</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_Nnr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># reduced node count; returns node_count - 1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Nn</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">_Nj</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>   <span class="c1"># alias for get_junction_count()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">edge_count</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_Nf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">face_count</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_Ic</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>     <span class="c1"># alias for get_critical_current_factors</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">critical_current_factors</span>

    <span class="k">def</span> <span class="nf">_R</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>      <span class="c1"># alias for get_resistance_factors</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">resistance_factors</span>

    <span class="k">def</span> <span class="nf">_C</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>      <span class="c1"># alias for get_resistance_factors</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span>

    <span class="k">def</span> <span class="nf">_L</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">inductance_factors</span>

    <span class="k">def</span> <span class="nf">_Mr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_prepare_junction_quantity</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">x_name</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">x_name</span> <span class="o">+</span> <span class="s2">&quot; must be scalar or array of length equal to junction count&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">x</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_prepare_inducance_matrix</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="s2">&quot;ndim&quot;</span><span class="p">):</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">Circuit</span><span class="o">.</span><span class="n">_prepare_junction_quantity</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">diags</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Circuit</span><span class="o">.</span><span class="n">_is_symmetric</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;inductance matrix must be symmetric&quot;</span><span class="p">)</span>
            <span class="n">eigv</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">(</span><span class="o">-</span><span class="n">A</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;LA&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">is_positive_definite</span> <span class="o">=</span> <span class="n">eigv</span> <span class="o">&lt;</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
            <span class="k">if</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">issparse</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
                <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">tocsc</span><span class="p">()</span>
                <span class="n">is_zero</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">nnz</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">is_zero</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">is_positive_definite</span><span class="p">,</span> <span class="n">is_zero</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;L must be scalar, (Nj,) array or (Nj, Nj) matrix&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;x: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;y: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">y</span><span class="p">)</span> <span class="o">+</span> \
               <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">node1: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">node1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">node2: </span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">node2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_A_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return ||A||_2 = sqrt(max(eig(A.T @ A))). (however computes sqrt(max(eig(A @ A.T))) which seems to be the same and is quicker)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Anorm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_matrix</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Anorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">((</span><span class="n">A</span> <span class="o">@</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;LA&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Anorm</span>

    <span class="k">def</span> <span class="nf">_get_M_norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return ||M||_2 = sqrt(max(eig(M.T @ M))). (however computes sqrt(max(eig(M @ M.T))) which seems to be the same and is quicker)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Mnorm</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">M</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cut_matrix</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Mnorm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigsh</span><span class="p">((</span><span class="n">M</span> <span class="o">@</span> <span class="n">M</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">double</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;LA&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Mnorm</span>

    <span class="k">def</span> <span class="nf">_A_solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solves the equation: A @ x = b (where A = cycle_matrix).</span>
<span class="sd">        If b is integral (contain only integers), the output array x will also be integral.</span>

<span class="sd">        input:  b (..., Nf)</span>
<span class="sd">        output: x (..., Nj)</span>

<span class="sd">        Notes:</span>
<span class="sd">            - The equation is underdetermined, so the solution x is not unique.</span>

<span class="sd">        Use cases:</span>
<span class="sd">            - Used for changing phase zones (theta, z) -&gt; (theta&#39;, z&#39;).</span>
<span class="sd">              Here theta&#39; = theta + 2 * pi * Z where A @ Z = z&#39; - z. Crucially, Z must</span>
<span class="sd">              be integral to ensure theta keeps obeying Kirchhoff&#39;s current rule.</span>
<span class="sd">            - Used for projecting theta onto cycle space; theta&#39; = theta - g so that A @ theta&#39;= 0.</span>
<span class="sd">              Then A @ g = 2 * pi * (z - areas * f)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">_cycle_space_solve_for_integral_x</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_has_capacitance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># returns False if self.capacitance_factors is zero, True otherwise</span>
        <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">capacitance_factors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_has_inductance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># returns False if self.inductance_factors is zero, True otherwise</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_inductance_v</span>

    <span class="k">def</span> <span class="nf">_has_mixed_inductance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mixed_inductance_mask</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_mixed_inductance_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_L</span><span class="p">()</span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_cycle_matrix</span><span class="p">()</span>
        <span class="n">ALA</span> <span class="o">=</span> <span class="n">A</span> <span class="o">@</span> <span class="n">L</span> <span class="o">@</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ALA</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_assign_cut_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_square</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced_transposed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_transposed</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cut_matrix</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">cut_space_matrix</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix</span> <span class="o">=</span> <span class="n">cut_matrix</span><span class="o">.</span><span class="n">asformat</span><span class="p">(</span><span class="s2">&quot;csc&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced</span> <span class="o">=</span> <span class="n">cut_matrix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">asformat</span><span class="p">(</span><span class="s2">&quot;csc&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cut_matrix_reduced</span>

    <span class="k">def</span> <span class="nf">_junction_centers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_coordinates</span><span class="p">()</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">n2</span><span class="p">]),</span>  <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_junction_lengths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_coordinates</span><span class="p">()</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_junction_inner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids1</span><span class="p">,</span> <span class="n">ids2</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_node_coordinates</span><span class="p">()</span>
        <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_junction_nodes</span><span class="p">()</span>
        <span class="n">x_n1_j1</span><span class="p">,</span> <span class="n">y_n1_j1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">[</span><span class="n">ids1</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">[</span><span class="n">ids1</span><span class="p">]]</span>
        <span class="n">x_n2_j1</span><span class="p">,</span> <span class="n">y_n2_j1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n2</span><span class="p">[</span><span class="n">ids1</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">[</span><span class="n">ids1</span><span class="p">]]</span>
        <span class="n">x_n1_j2</span><span class="p">,</span> <span class="n">y_n1_j2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">[</span><span class="n">ids2</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">[</span><span class="n">ids2</span><span class="p">]]</span>
        <span class="n">x_n2_j2</span><span class="p">,</span> <span class="n">y_n2_j2</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n2</span><span class="p">[</span><span class="n">ids2</span><span class="p">]],</span> <span class="n">y</span><span class="p">[</span><span class="n">n2</span><span class="p">[</span><span class="n">ids2</span><span class="p">]]</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x_n2_j1</span> <span class="o">-</span> <span class="n">x_n1_j1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x_n2_j2</span> <span class="o">-</span> <span class="n">x_n1_j2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">y_n2_j1</span> <span class="o">-</span> <span class="n">y_n1_j1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">y_n2_j2</span> <span class="o">-</span> <span class="n">y_n1_j2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_junction_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ids1</span><span class="p">,</span> <span class="n">ids2</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_junction_centers</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="n">ids2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ids1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">ids2</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">ids1</span><span class="p">])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_is_symmetric</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">isspmatrix</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">)</span><span class="o">.</span><span class="n">nnz</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">A</span> <span class="o">==</span> <span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_junction_remove_mask</span><span class="p">(</span><span class="n">nodes1</span><span class="p">,</span> <span class="n">nodes2</span><span class="p">,</span> <span class="n">node_remove_mask</span><span class="p">):</span>
        <span class="n">node_remove_mask</span> <span class="o">=</span> <span class="n">node_remove_mask</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">remove_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">node_remove_mask</span><span class="p">)</span>
        <span class="n">new_node_id</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">node_remove_mask</span><span class="o">.</span><span class="n">size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">node_remove_mask</span><span class="p">)</span> <span class="o">-</span> <span class="n">node_remove_mask</span><span class="p">)</span>
        <span class="n">junc_remove_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes1</span><span class="p">,</span> <span class="n">remove_nodes</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">nodes2</span><span class="p">,</span> <span class="n">remove_nodes</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">junc_remove_mask</span><span class="p">,</span> <span class="n">new_node_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_lobpcg_matrix_norm</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">preconditioner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1E-5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes ||A||_2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lobpcg_out</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">lobpcg</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">M</span><span class="o">=</span><span class="n">preconditioner</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="n">maxiter</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lobpcg_out</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>


<div class="viewcode-block" id="SquareArray"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.SquareArray">[docs]</a><span class="k">class</span> <span class="nc">SquareArray</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count_x</span><span class="p">,</span> <span class="n">count_y</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">EmbeddedSquareGraph</span><span class="p">(</span><span class="n">count_x</span><span class="p">,</span> <span class="n">count_y</span><span class="p">,</span> <span class="n">x_scale</span><span class="p">,</span> <span class="n">y_scale</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">horizontal_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_juncion_coordinates</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">y1</span> <span class="o">==</span> <span class="n">y2</span>

    <span class="k">def</span> <span class="nf">vertical_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontal_junctions</span><span class="p">()</span></div>


<div class="viewcode-block" id="HoneycombArray"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.HoneycombArray">[docs]</a><span class="k">class</span> <span class="nc">HoneycombArray</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count_x</span><span class="p">,</span> <span class="n">count_y</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">EmbeddedHoneycombGraph</span><span class="p">(</span><span class="n">count_x</span><span class="p">,</span> <span class="n">count_y</span><span class="p">,</span> <span class="n">x_scale</span><span class="p">,</span> <span class="n">y_scale</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">horizontal_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_juncion_coordinates</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">y1</span> <span class="o">==</span> <span class="n">y2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">vertical_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontal_junctions</span><span class="p">()</span></div>


<div class="viewcode-block" id="TriangularArray"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.TriangularArray">[docs]</a><span class="k">class</span> <span class="nc">TriangularArray</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count_x</span><span class="p">,</span> <span class="n">count_y</span><span class="p">,</span> <span class="n">x_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">y_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">EmbeddedTriangularGraph</span><span class="p">(</span><span class="n">count_x</span><span class="p">,</span> <span class="n">count_y</span><span class="p">,</span> <span class="n">x_scale</span><span class="p">,</span> <span class="n">y_scale</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">horizontal_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_juncion_coordinates</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">y1</span> <span class="o">==</span> <span class="n">y2</span>

    <span class="k">def</span> <span class="nf">vertical_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">horizontal_junctions</span><span class="p">()</span></div>


<div class="viewcode-block" id="SQUID"><a class="viewcode-back" href="../josephson_circuit.html#josephson_circuit.SQUID">[docs]</a><span class="k">class</span> <span class="nc">SQUID</span><span class="p">(</span><span class="n">Circuit</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A SQUID is modeled as a square where the vertical junctions have Ic=1000</span>
<span class="sd">    and the horizontal Ic=1.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">node1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">node2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">EmbeddedGraph</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">node1</span><span class="p">,</span> <span class="n">node2</span><span class="p">)</span>
        <span class="n">Ic</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">graph</span><span class="p">,</span> <span class="n">critical_current_factors</span><span class="o">=</span><span class="n">Ic</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">horizontal_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">vertical_junctions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span></div>

<span class="k">def</span> <span class="nf">test_function</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, MartijnLankhorst.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>